<% provide(:title, "Survey") %>
<style>
#main-center {
    width: 100%;
    height: 100%;
}
#survey-body {
    max-width: 40em;
    margin: 0 auto 0 auto;
    box-sizing: border-box;
}
.form-group > label {
    font-size: 18px;
    font-weight: bold;
}
.custom {
    display: flex;
    align-items: center;
}
.remove {
    height: 14px;
    width: 14px;
    padding: 0;
    margin-right: 6px;
    line-height: 12px;
    flex: 0 0 auto;
}
.pager .page {
    display: none;
}
.pager .page.showing {
    display: block;
}
.form-check {
    width: 100%;
    text-align: left;
    cursor: default !important;
    border-radius: 0;
    background-color: transparent;
    border: 0;
    padding-top: 2px;
    padding-bottom: 2px;
}
</style>
<div id="survey-body" class="h-100 pager p-2 d-flex flex-column">
    <div class="auto-overflow yes-flex mb-2 " id="survey-scroller">
        <form>
            <div class="page">
                <h3 class="text-center">Welcome to our Survey</h3>
                <p>This survey is composed of three parts, each about 40 seconds in length. Total time of completion is 1&#189; to 3 minutes.</p>
                <p>This survey is designed to help us understand a few aspects of how people manage the job application process, in order to guide Jobber's development so that it actually meets your needs and wants.</p>
                <p>The survey data is completely anonymously collected and will be shared with no one, which is why the survey isn't a Google Form. We consider privacy to be a fundamental human right, and couldn't guarantee that right to you unless we wrote the survey entirely by ourselves.</p>
            </div>
            <div class="page">
                <h3 class="text-center">Section 1</h3>
                <div class="form-group">
                    <label>When searching for a job, roughly how many separate job applications do you tend to manage at any one time?</label>
                    <input required="true" type="number" class="form-control" max="100" min="1" value="1"/>
                </div>
                <div class="form-group" id="how-tracking">
                    <label>How do you normally keep track of your applications and their documents as you apply to them?</label>
                </div>
            </div>
            <div class="page">
                <h3 class="text-center">Section 2</h3>
                <div class="form-group" id="extra-documents">
                    <label>What documents have been requested from you in past applications, aside from CVs?</label>
                </div>
                <div class="form-group" id="document-creation-softwares">
                    <label>What programs or softwares do you use to create documents for applications?</label>
                </div>
            </div>
            <div class="page">
                <h3 class="text-center">Section 3</h3>
                <div class="form-group">
                    <label>How many different CVs do you generally maintain at a given time?</label>
                    <input required="true" type="number" class="form-control" max="100" min="1" value="1"/>
                </div>
                <div class="form-group" id="update-frequency">
                    <label>How often do you update or change your CV's contents or layout?<br/>
                        <small class="text-muted text-normal">(Pick the first that applies.)</small>
                    </label>
                </div>
            </div>
        </form>
    </div>
    <div class="no-flex d-flex justify-content-center">
        <div class="btn btn-themed border-0 mr-2 prev">Prev Section</div>
        <div class="btn btn-themed border-0 next">Next Section</div>
        <button class="btn btn-themed border-0" type="submit" id="survey-submitter">Submit Responses</div>
    </div>
</div>
<script>
function Pager (id, onSubmit) {
    this.id = id;
    this.node = document.getElementById(this.id);
    this.pages = document.getElementsByClassName("page");
    
    this.scroller = document.getElementById("survey-scroller");
    
    this.prev = this.node.getElementsByClassName("prev")[0];
    this.prev.addEventListener("click", this.prevPage.bind(this));
    this.next = this.node.getElementsByClassName("next")[0];
    this.next.addEventListener("click", this.nextPage.bind(this));

    this.submit = document.getElementById("survey-submitter");

    this.setIndex(0);
}
Pager.prototype.setIndex = function (index) {
    if (this.index != undefined) {
        this.pages[this.index].classList.remove("showing");
    }
    if (this.index == index) return;

    this.index = index;

    this.pages[this.index].classList.add("showing");

    this.prev.style.display = null;
    this.next.style.display = null;
    this.submit.style.display = "none";
    this.prev.innerHTML = "Prev Section";
    this.next.innerHTML = "Next Section";
    if (this.index === 0) {
        this.prev.style.display = "none";
        this.next.innerHTML = "Start the Survey";
    } else if (this.index === this.pages.length - 1) {
        this.next.style.display = "none";
        this.submit.style.display = null;
    }
    
    // scroll the form back to the top
    this.scroller.scrollTop = 0;
}
Pager.prototype.nextPage = function () {
    if (this.index === this.pages.length - 1) return;
    this.setIndex(this.index + 1);
}
Pager.prototype.prevPage = function () {
    if (this.index === 0) return;
    this.setIndex(this.index - 1);
}

function Checklist (id, inputs, radio, unmodifiable) {
    this.id = id;
    this.node = document.getElementById(this.id);
    this.type = radio ? "radio" : "checkbox";

    // If radio mode is set, use same name for all boxes
    for (var input of inputs) {
        var name = input[0]; 
        var text = input[1];
        var c = this.createCheckbox(name, text);
        this.node.appendChild(c);
    }

    if (unmodifiable !== true) {
        var addButton = document.createElement("div");
        addButton.innerHTML = "Don't see your option? Click to add another.";
        addButton.className = "btn btn-themed btn-sm mt-2 w-100 border-0";
        addButton.addEventListener("click", this.newCustomInput.bind(this));
        this.addButton = addButton;
        this.node.appendChild(addButton);
    }
}
Checklist.prototype.removeChild = function (child) {
    this.node.removeChild(child);
}
Checklist.prototype.createCheckbox = function (name, text, checkbox, textNode) {
    var container = document.createElement("div");
    container.className = "form-check btn btn-light";

    if (textNode == undefined && checkbox == undefined) {
        checkbox = document.createElement("input");
        if (this.type === "radio") {
            checkbox.name = this.id;
            checkbox.value = name;
        } else {
            checkbox.name = name;
        }
        checkbox.type = this.type;
        checkbox.checked = false;

        container.addEventListener("click", function () {
            checkbox.checked = !checkbox.checked;
        });
        
        textNode = document.createTextNode(" " + text);
    }
    
    container.appendChild(checkbox);
    container.appendChild(textNode);
    return container;
}
Checklist.prototype.newCustomInput = function () {
    var remove = document.createElement("div");
    remove.className = "remove btn btn-outline-danger";
    remove.innerHTML = "&times;";
    remove.style.paddingLeft = "1px";

    var input = document.createElement("input");
    input.type = "text";
    input.className = "form-control form-control-sm";
    input.placeholder = "Enter new option here...";

    var container = this.createCheckbox("", "", remove, input);
    container.classList.add("d-flex", "align-items-center");
    remove.addEventListener("click", this.removeChild.bind(this, container));

    this.node.insertBefore(container, this.addButton);

    input.focus();
}

new Pager("survey-body");

new Checklist("how-tracking"
             ,[["docs", "Word Documents / Typed Up Files (.doc, .txt, .etc)"]
              ,["spread", "Spreadsheets (Excel, Gnumeric, etc.)"]
              ,["paper", "Pen and Paper (Notebook, Post-Its, etc.)"]
              ]
             );
new Checklist("extra-documents"
             ,[["cover", "Cover Letter"]
              ,["reference", "Letter of Reference / Recommendation"]
              ,["philosophy", "Work Philosophy"]
              ]
             );
new Checklist("document-creation-softwares"
             ,[["word", "Word / Google Docs / Other Office Suite Software"]
              ,["latex", "LaTeX"]
              ,["indesign", "InDesign / GIMP / Other Design and Artwork Software"]
              ]
             );
new Checklist("update-frequency"
             ,[["job", "For every job application"]
              ,["skill", "Every time I acquite a new skill"]
              ,[">1pmo", "More than once a month"]
              ,[">3pmo", "More than once every 3 months"]
              ,[">1pyr", "More than once a year"]
              ,["<1pyr", "Less than once a year"]
              ]
             ,true,true);
</script>

